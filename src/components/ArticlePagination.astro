---
import { minima } from "../lib/minima";
import { getArticleUrl } from "../lib/url";

interface Props {
  currentSlug: string;
}

const { currentSlug } = Astro.props;

// Fetch recent articles to find prev/next
// Simple approach: fetch recent 50 articles and find current article position
// This works well for most cases (articles that are relatively recent)
// Limitation: If article is older than 50 most recent, prev/next will be null
const recentArticlesResponse = await minima.getPublicArticles({
  limit: 50,
  orderBy: "publishedAt",
  order: "desc",
});
const recentArticles = recentArticlesResponse.data?.data || [];

// Find current article index in the list
const currentIndex = recentArticles.findIndex((a) => a.slug === currentSlug);

// Previous article is the one after current in desc order (older)
const prevArticle =
  currentIndex >= 0 && currentIndex < recentArticles.length - 1
    ? recentArticles[currentIndex + 1]
    : null;

// Next article is the one before current in desc order (newer)
const nextArticle = currentIndex > 0 ? recentArticles[currentIndex - 1] : null;
---

{
  (prevArticle || nextArticle) && (
    <div>
      <nav class="flex justify-between">
        <div>
          {prevArticle && (
            <div>
              <small>Previous Article</small>
              <br />
              <a href={getArticleUrl(prevArticle)}>← {prevArticle.headline}</a>
            </div>
          )}
        </div>
        <div>
          {nextArticle && (
            <div>
              <small>Next Article</small>
              <br />
              <a href={getArticleUrl(nextArticle)}>{nextArticle.headline} →</a>
            </div>
          )}
        </div>
      </nav>
    </div>
  )
}
